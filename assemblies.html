<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Assemblies - LITCoder</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/tutorials.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="index.html" class="nav-logo">LITCoder</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="tutorials.html">Tutorials</a>
                <a href="https://arxiv.org/abs/2509.09152" target="_blank">Paper</a>
                <a href="https://github.com/GT-LIT-Lab/litcoder_core" target="_blank">GitHub</a>
            </div>
        </nav>

        <header class="tutorial-header">
            <h1>üß± Understanding Assemblies in LITCoder</h1>
            <p>Assemblies organize brain data, stimuli, timing, and metadata for training encoding models.</p>
        </header>

        <section class="tutorial-section">
            <h2>What is an Assembly?</h2>
            <div class="concept-card">
                <p>An <span class="highlight">Assembly</span> is a structured container that holds:</p>
                <ul>
                    <li><strong>Brain Data</strong>: Preprocessed fMRI aligned with stimuli</li>
                    <li><strong>Stimuli</strong>: Text or audio presented during the experiment</li>
                    <li><strong>Timing</strong>: TR times, precise word/audio times, and split indices</li>
                    <li><strong>Metadata</strong>: Story names, subject info, and validation strategy</li>
                </ul>
            </div>
        </section>

        <section class="tutorial-section">
            <h2>Why assemblies?</h2>
            <div class="pipeline-step">
                <div class="step-icon">üß©</div>
                <div class="step-content">
                    <h4>Single source of truth</h4>
                    <p>Assemblies unify stimuli, timing, and neural data so downstream code can be simple and consistent across datasets.</p>
                </div>
            </div>
            <div class="pipeline-step">
                <div class="step-icon">üõ°Ô∏è</div>
                <div class="step-content">
                    <h4>Reproducibility</h4>
                    <p>Validation methods and story ordering live with the data, preventing accidental leakage and ordering bugs.</p>
                </div>
            </div>
            <div class="pipeline-step">
                <div class="step-icon">üöÄ</div>
                <div class="step-content">
                    <h4>Performance</h4>
                    <p>Pre-aligned, cached attributes enable fast iterations when swapping feature extractors and models.</p>
                </div>
            </div>

            <div class="parameter-grid" style="margin-top: 1.5rem;">
                <div class="param-card">
                    <h4>Common use-cases</h4>
                    <ul>
                        <li>Quick baselines (e.g., word rate)</li>
                        <li>Comparing model families across the same data</li>
                        <li>Ablations with different trimming and FIR delays</li>
                    </ul>
                </div>
                <div class="param-card">
                    <h4>Pitfalls to avoid</h4>
                    <ul>
                        <li>Mismatched story ordering when concatenating</li>
                        <li>Ignoring dataset-specific trimming recommendations</li>
                        <li>Overriding validation method without understanding it</li>
                    </ul>
                </div>
                <div class="param-card">
                    <h4>Tips</h4>
                    <ul>
                        <li>Inspect <code>split_indices</code> to sanity-check alignment</li>
                        <li>Start with packaged assemblies before building your own</li>
                        <li>Cache heavy feature computations to speed up iteration</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="tutorial-section">
            <h2>Load and Inspect an Assembly</h2>
            <pre class="code-block"><code class="language-python">from encoding.assembly.assembly_loader import load_assembly

# Load the pre-packaged LeBel assembly
assembly = load_assembly("assembly_lebel_uts03.pkl")

print(f"Assembly shape: {assembly.shape}")
print(f"Stories: {assembly.stories}")
print(f"Validation method: {assembly.get_validation_method()}")</code></pre>
        </section>

        <section class="tutorial-section">
            <h2>Exploring Contents</h2>
            <pre class="code-block"><code class="language-python"># Overview
print("=== Assembly Overview ===")
print(f"Total presentations: {assembly.shape[0]}")
print(f"Number of voxels/vertices: {assembly.shape[1]}")
print(f"Stories: {assembly.stories}")
print(f"Validation method: {assembly.get_validation_method()}")

# Per-story details
print("\n=== Story Details ===")
for story in assembly.stories:
    story_data = assembly.story_data[story]
    print(f"\nStory: {story}")
    print(f"  Brain data shape: {story_data.brain_data.shape}")
    print(f"  Number of stimuli: {len(story_data.stimuli)}")
    print(f"  Split indices: {len(story_data.split_indices)} words")
    print(f"  TR times: {len(story_data.tr_times)} TRs")
    print(f"  Data times: {len(story_data.data_times)} words")

    # Peek at stimuli and alignment
    print(f"  First 3 stimuli: {story_data.stimuli[:3]}")
    print(f"  First 10 split indices: {story_data.split_indices[:10]}")
    print(f"  Last 10 split indices: {story_data.split_indices[-10:]}")</code></pre>
        </section>

        <section class="tutorial-section">
            <h2>Story-Level Access</h2>
            <pre class="code-block"><code class="language-python">story_name = assembly.stories[0]
story_data = assembly.story_data[story_name]

print(f"Story: {story_name}")
print(f"  Brain data: {story_data.brain_data.shape}")
print(f"  Stimuli: {len(story_data.stimuli)}")
print(f"  Split indices: {len(story_data.split_indices)}")
print(f"  TR times: {len(story_data.tr_times)}")
print(f"  Data times: {len(story_data.data_times)}")

brain_data = story_data.brain_data
stimuli = story_data.stimuli
split_indices = story_data.split_indices
tr_times = story_data.tr_times
data_times = story_data.data_times</code></pre>
        </section>

        <section class="tutorial-section">
            <h2>Using an Assembly in Training</h2>
            <pre class="code-block"><code class="language-python">from encoding.assembly.assembly_loader import load_assembly
from encoding.features.factory import FeatureExtractorFactory
from encoding.downsample.downsampling import Downsampler
from encoding.models.nested_cv import NestedCVModel
from encoding.trainer import AbstractTrainer

assembly = load_assembly("assembly_lebel_uts03.pkl")

extractor = FeatureExtractorFactory.create_extractor(
    modality="wordrate",
    model_name="wordrate",
    config={},
    cache_dir="cache",
)

downsampler = Downsampler()
model = NestedCVModel(model_name="ridge_regression")

fir_delays = [1, 2, 3, 4]
trimming_config = {
    "train_features_start": 10,
    "train_features_end": -5,
    "train_targets_start": 0,
    "train_targets_end": None,
    "test_features_start": 50,
    "test_features_end": -5,
    "test_targets_start": 40,
    "test_targets_end": None,
}

trainer = AbstractTrainer(
    assembly=assembly,
    feature_extractors=[extractor],
    downsampler=downsampler,
    model=model,
    fir_delays=fir_delays,
    trimming_config=trimming_config,
    use_train_test_split=True,
    logger_backend="wandb",
    wandb_project_name="lebel-tutorial",
    dataset_type="lebel",
    results_dir="results",
)

metrics = trainer.train()
print({
    "median_correlation": metrics.get("median_score", float("nan")),
    "n_significant": metrics.get("n_significant"),
})</code></pre>
        </section>

        <footer class="footer">
            <div>¬© 2025 LITCoder Project ‚Äî Georgia Tech</div>
            <div style="font-size: 0.8rem; margin-top: 4px;">Authors: Taha Binhuraib, Ruimin Gao, Anna A. Ivanova</div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html> 